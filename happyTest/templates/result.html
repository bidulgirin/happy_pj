{% extends './common/common.html' %}
{% load static %}
{% block contents %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
    </script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link rel="stylesheet" href="{% static 'css/style.css' %}">

{% if request.user.is_superuser %}
{% include './common/navi.html' %}
{% endif %}
<div class="container container-sm">

    <div class="result_report">
        <h3 class="title"> ë‹¹ì‹ ì˜ í–‰ë³µ ì ìˆ˜ëŠ”?</h3>
        <h1>{{total_score}}ì </h1>
        <p>{{text}}</p>

        <canvas id="myChart"></canvas>
        <div style="text-align: left; font-size:.8rem; color:rgb(206, 205, 255); margin-top:10px;">
            ìƒì¡´: ê±´ê°• ë° ê¸°ë³¸ì ì¸ ìƒí™œ ì—¬ê±´ ë§Œì¡±ë„<br />
            ê´€ê³„: ê°€ì¡±, ì¹œêµ¬, ë™ë£Œì™€ì˜ ì‚¬íšŒì  ìœ ëŒ€ê°<br />
            ì„±ì¥: ê°œì¸ì˜ ì„±ì¥, ë°°ì›€, ì„±ì·¨ì™€ ê°™ì´ ìê¸° ê³„ë°œ<br />
        </div>
        <hr>
        {% if a_type_low or b_type_low or c_type_low %}

        {% endif %}
        {% if a_type_low %}
        <b>"{{a_type_low}}"</b>
        {% endif %}
        {% if b_type_low %}
        <b>"{{b_type_low}}"</b>
        {% endif %}
        {% if c_type_low %}
        <b>"{{c_type_low}}"</b>
        {% endif %}
        {% if a_type_low or b_type_low or c_type_low %}
        ì§€ìˆ˜ê°€ í‰ê· ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤
        {% endif %}
        <button class="ico_kakao">ì¹´ì¹´ì˜¤í†¡ ê³µìœ í•˜ê¸°</button>
        <div class="solution_datas">
            {% if bookSolution.count > 0 %}
            <p>ğŸ’Œì¶”ì²œ ì±…ğŸ’Œ</p>
            {% for i in bookSolution %}
            <a href="{{i.book_url|safe}}" data-aos="fade-up">
                <div class="card">
                    {% if i.cover_url %}
                    <img src="{{i.cover_url|safe}}" class="card-img-top" alt="{{i.title|safe|truncatechars:30}}">
                    {% endif %}
                </div>
            </a>
            {% endfor %}
            <script>
                AOS.init();
            </script>
            {% endif %}
        </div>
        <hr>

    </div>
    <div class="solution">

        <div class="solution_datas">
            {% if solutions.count > 0 %}
            <div>
                <p class="title">í–‰ë³µì„ ìœ„í•œ ê¿€íŒ!</p>
                <p>âœ¨ì¶”ì²œ ì˜ìƒâœ¨</p>
            </div>
            {% for i in solutions %}
            <a href="{{i.video_url|safe}}" data-aos="fade-up">
                <div class="card">
                    {% if i.thumbnail_url %}
                    <img src="{{i.thumbnail_url|safe}}" class="card-img-top" alt="...">
                    {% endif %}
                    <div class="card-body">
                        <p class="card-title">{{i.title|safe|truncatechars:30}}</p>
                    </div>
                </div>
            </a>
            {% endfor %}
            <script>
                AOS.init();
            </script>
            {% endif %}
        </div>
    </div>
</div>
<div class="area">
    <ul class="circles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    type_a = Number('{{result.final_a_type_score}}')
    type_b = Number('{{result.final_b_type_score}}')
    type_c = Number('{{result.final_c_type_score}}')
    console.log("type_a", type_a)
    console.log("type_b", type_b)
    console.log("type_c", type_c)
</script>
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
    integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4"
    crossorigin="anonymous"></script>
<script>
    const ctx = document.getElementById('myChart');

    let chart = new Chart(ctx, {
        type: 'radar',
        data: {
            datasets: [{
                label: 'í–‰ë³µì§€ìˆ˜',
                data: [type_a, type_b, type_c]
            }],
            labels: ['ìƒì¡´', 'ê´€ê³„', 'ì„±ì¥']
        },
        options: {
            scales: {
                r: {
                    suggestedMin: 0,
                    suggestedMax: 50,
                }
            }
        }
    });

    // ê³µìœ í•˜ê¸°
    const url = window.location.href.replace('#', '');   	//í˜„ì¬ URL íšë“
    const encodedUrl = encodeURIComponent(url);		//URL ì¸ì½”ë”©
    const message = encodeURIComponent('ê³µìœ í•˜ê¸° ìƒ˜í”Œì´ì˜ˆìš”~');  //ê³µìœ  íƒ€ì´í‹€ ì¸ì½”ë”©
    const features = 'width=600, height=700, resizable=no'  //ìœˆë„ìš° ì‚¬ì´ì¦ˆ
    //ì¶œì²˜: https://februaryfairys.tistory.com/132 [IT ì„±ì¥ì¼ê¸°:í‹°ìŠ¤í† ë¦¬]

    // NAVER
    $('.ico_naver').click(function () {
        window.open(`https://share.naver.com/web/shareView?url=${encodedUrl}&title=${message}`
            , 'naver', features);
    });
    // KAKAO
    const personalKey = 'ë°œê¸‰ë°›ì€ Javascript ì•± í‚¤'
    Kakao.init(personalKey); //KAKAO SDK ëª¨ë“ˆ ì´ˆê¸°í™”
    $('.ico_kakao').click(function () {
        Kakao.Share.sendDefault({
            objectType: 'feed',
            content: {
                title: 'ê³µìœ í•˜ê¸° ìƒ˜í”Œì´ì˜ˆìš”~',
                imageUrl: url + 'resources/images/kakao_share.png', //ê³µìœ  ì‹œ í‘œì‹œë  ì´ë¯¸ì§€ ë¦¬ì†ŒìŠ¤
                link: {
                    mobileWebUrl: url, //ëª¨ë°”ì¼ì˜ ê²½ìš° ì—°ê²°í•  URL
                    webUrl: url	//ì›¹ì˜ ê²½ìš° ì—°ê²°í•  URL
                }
            },
            buttons: [
                {
                    title: 'ë²„íŠ¼ í•˜ë‚˜',
                    link: {
                        mobileWebUrl: url,
                        webUrl: url
                    }
                },
                {
                    title: 'ë²„íŠ¼ ë‘˜',
                    link: {
                        mobileWebUrl: url,
                        webUrl: url
                    }
                }
            ]
        });
    });
</script>
{% endblock %}